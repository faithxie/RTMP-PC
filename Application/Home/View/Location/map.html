<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title></title>

<link rel="stylesheet" type="text/css" href="__PUBLIC__/easyui/easyui/1.3.4/themes/default/easyui.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/easyui/css/wu.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/easyui/css/icon.css" />
<link href="__PUBLIC__/easyui/icons/icon-all.css" rel="stylesheet" type="text/css" />

 <script type="text/javascript" src="__PUBLIC__/easyui/js/jquery-1.8.0.min.js"></script>

<script type="text/javascript" src="__PUBLIC__/easyui/easyui/1.3.4/jquery.easyui.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/easyui/easyui/1.3.4/locale/easyui-lang-zh_CN.js"></script>




<style type="text/css">
*{
    margin:0px;
    padding:0px;
}
body, button, input, select, textarea {
    font: 12px/16px Verdana, Helvetica, Arial, sans-serif;
}
#container{
	min-width:600px;
	min-height:767px;
}
</style>
<script charset="utf-8" src="https://map.qq.com/api/js?v=2.exp&key=JV2BZ-6UWYI-XE3G5-52NOK-DELD5-QHBNZ"></script>
<script>
var init = function() {
    var center = new qq.maps.LatLng(35.972401,117.045113);
    var map = new qq.maps.Map(document.getElementById('container'),{
        center: center,
        zoom: 10
    });

    var anchor = new qq.maps.Point(6, 6),
        size = new qq.maps.Size(24, 24),
        origin = new qq.maps.Point(0, 0),
        icon = new qq.maps.MarkerImage('__PUBLIC__/center.gif', size, origin, anchor);

     var info = new qq.maps.InfoWindow({ map: map });      //添加提示窗


    // var marker = new qq.maps.Marker({
    //     icon: icon,
    //     map: map,
    //     position:map.getCenter()});
      var result = {$result};

    //result中数据 用于显示标记、和标记点击时的提示信息
    if(result.code==0 && result.msg=="success"){
        for(var i=0; i<result.data.length; i++){
            var data = result.data[i];
            console.log(result.data.length);
            var marker = new qq.maps.Marker({ 
            	icon: icon,
            	position: new qq.maps.LatLng(data.latitude, data.longitude), 
            	map: map 
            });    //创建标记
            //***将必要的数据存入每一个对应的marker对象
            marker.id = data.id;
            marker.name = data.name;
            marker.locate = data.locate;
            qq.maps.event.addListener(marker, 'click', function() {    //获取标记的点击事件
                info.open();  //点击标记打开提示窗
                info.setContent('<div class="mapInfo"><p class="center">可信度：'+this.name+'</p><p>时间：'+this.locate+'</p><p>经纬度：'+this.position.lat+'/'+this.position.lng+'</p><button type="button" onclick="bindShop(\''+this.id+'\')">查看</button></div>');  //***设置提示窗内容（这里用到了marker对象中保存的数据）
                info.setPosition(new qq.maps.LatLng(this.position.lat, this.position.lng));  //提示窗位置
            });
        }
    }else{
        //layer.open({ content: "获取附近商铺失败", skin: 'msg', time: 2 });
    }

}
function bindShop(id){

	showMessageDialog('{:U("Location/epersoninfo")}'+'/id/'+id,'详细信息',900,500,true);

}

function showMessageDialog(url, title, width, height, shadow) {
	
	    var content = '<iframe src="' + url + '" width="100%" height="99%" frameborder="0" scrolling="no"></iframe>';
	    var boarddiv = '<div id="msgwindow" title="' + title + '"></div>'
	    //style="overflow:hidden;"可以去掉滚动条
	    $(document.body).append(boarddiv);
	    var win = $('#msgwindow').dialog({
	        content: content,
	        width: width,
	        height: height,
	        modal: shadow,
	        title: title,
	        closable:true,    
            collapsible:true,
            // minimizable:true,
            // maximizable:true,
	        onClose: function () {
	            $(this).dialog('destroy');//后面可以关闭后的事件
	        }
	    });
	    win.dialog('open');
	}



</script>
</head>
<body onload="init()">
<div id="container"></div>
<p id="info" style="margin-top:10px;"></p>
</body>
</html>
