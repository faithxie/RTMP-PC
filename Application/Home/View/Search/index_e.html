<!DOCTYPe html>
<html lang="zh-CN">

 <script src="__PUBLIC__/static/script/jquery.1.11.1.js"></script>
    <script src="__PUBLIC__/static/script/bootstrap.min.js"></script>
    <!-- Bootstrap -->
<link href="__PUBLIC__/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap -->
    <!-- 自定义 css -->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/static/css/reset.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/static/css/common.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/static/css/style.css">
    <!-- font awesome -->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/static/plugins/FontAwesome/css/font-awesome.min.css">
    <!--easyui包含文件-->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/static/plugins/easyui1.5.3/themes/material/easyui.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/static/plugins/easyui1.5.3/themes/icon.css">
<script type="text/javascript" src="__PUBLIC__/static/plugins/easyui1.5.3/jquery.easyui.min.js"></script>
   
<link rel="stylesheet" type="text/css" href="__PUBLIC__/easyui/easyui/1.3.4/themes/default/easyui.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/easyui/css/wu.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/easyui/css/icon.css" />
<link href="__PUBLIC__/easyui/icons/icon-all.css" rel="stylesheet" type="text/css" />
  
<body>
  

  <!--   <div id="header"></div> -->
    <!-- indexmain -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 mainbox" id="mainbox">
                <div class="col-md-12 rights" id="right">
                 
                    <div class="toolbars clearfix">
                     
                        <div class="txiala">
                            <div>
                                <form id = 'ff' method="post" action="javascript:0">
                                 <select name = 'sqlsearch' id = "sqlsearch">
                                        <volist name = 'analyse' id= 'v'>
                                        <option value = "{$v['fieldname']} {$v['operation']} {$v['fieldvalue']}">{$v['fielddes']}{$v['operation']}{$v['showvalue']}</option>
                                        </volist>
                                    </select>
                                    <a id="btn" href="javascript:0" class="easyui-linkbutton" data-options="iconCls:'icon-search'" style="margin-left:10px;margin-top: 20px;margin-bottom: 10px" >查询</a>  
                                </form>
                            </div>



                        </div>
                    </div>
                    <!-- contents -->
                    <div class="contents clearfix">
                     
                             <!-- 详细信息 -->
                        <div class="xiangxixinxi" style="width: 100%;height: 500px">
                      
                            <table id="wu-datagrid" toolbar="#wu-toolbar"></table>
                    

                             <!--  <iframe id='myIframe' src="" style="width:100%;height:700px" frameborder="0" scrolling="yes"></iframe>
                                <div id = 'personli'>
                                    
                                </div> -->

                         </div>
                     </div>   
                </div>
                <!--mainboxend-->
            </div>
        </div>
    </div>
    <!-- indexmain end -->
    <!-- footer -->
   <!--  <div id="footer"></div> -->

   <input  type = "hidden" name="b0100" id ="b0100" value="001001">

<script type="text/javascript">
    /**
    * Name 载入数据
    */
    //创建时间格式化显示
    /**************************************时间格式化处理************************************/
    function dateFtt(fmt,date)   
    { //author: meizz   
      var o = {   
        "M+" : date.getMonth()+1,                 //月份   
        "d+" : date.getDate(),                    //日   
        "h+" : date.getHours(),                   //小时   
        "m+" : date.getMinutes(),                 //分   
        "s+" : date.getSeconds(),                 //秒   
        "q+" : Math.floor((date.getMonth()+3)/3), //季度   
        "S"  : date.getMilliseconds()             //毫秒   
      };   
      if(/(y+)/.test(fmt))   
        fmt=fmt.replace(RegExp.$1, (date.getFullYear()+"").substr(4 - RegExp.$1.length));   
      for(var k in o)   
        if(new RegExp("("+ k +")").test(fmt))   
      fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
      return fmt;   
    } 

    function crtTimeFtt(value,row,index){
        if(value != null){
            var crtTime = new Date(value);
            return dateFtt("yyyy.MM",crtTime);//直接调用公共JS里面的时间类处理的办法  
        }   
    }

    $(function () {
        var t = $('#wu-datagrid').datagrid({
            url:'{:U("Search/egetpersonlist")}',
            rownumbers:true,
            width: 1000,
            singleSelect:false,
            pageSize:20,
            pageNumber:1,           
            pagination:true,
            multiSort:true,
            singleSelect:true,
            // fitColumns:true,
            fit:true,
            loadMsg: '正在查询，请稍后...',
            onDblClickRow:function (index, row) {
                //alert(index);
                 openShow(row.a0100);
            },
            frozenColumns: [[
                    { field: 'a0101', title:'姓名',width:50,sortable:true },
                    // { field: 'ID', title: 'ID', width: 80, sortable: true }
                ]],
            columns:[[
                // { checkbox:true},
                {
                        field: 'a0107',
                        title: '性别',
                        width: 30,
                        formatter: function(value,row,index){
                            if(value == 1){
                                return '男';
                            }else{
                                return '女';
                            }
                            
                        }
                },
                { field:'a0111',title:'出生年月',width:60,formatter:crtTimeFtt},
                { field:'a0126',title:'健康状况',width:60},
                { field:'a0173',title:'身份证号',width:150},
                { field:'mz',title:'民族',width:50},
                { field:'a0109',title:'籍贯',width:60},
                { field:'zz',title:'政治面貌',width:60
                },
                { field:'e0121',title:'入党时间',width:60,formatter:crtTimeFtt},
                { field:'e0131',title:'最高职务层次',width:80},
                { field:'e0132',title:'工作单位及职务',width:250},
                { field:'e0136',title:'最高全日制学历',width:80},
                { field:'e0138',title:'最高全日制学位',width:80},
                { field:'e0140',title:'最高在职学历',width:80},
                { field:'e0143',title:'最高在职学位',width:80},
                { field:'e0145',title:'最高学历',width:50},
                { field:'e0134',title:'专业技术职务',width:50},
                { field:'a0100',title:'查看详情',width:150,
                    formatter: function(value,row,index){
                            return "<button onclick= 'openShow(\""+value+"\")'>查看</button><button onclick= 'fenxi(\""+value+"\")'>分析</button>"
                            
                        }
                }
            ]],
            headerContextMenu: [
                {
                    text: "冻结该列", disabled: function (e, field) { return t.datagrid("getColumnFields", true).contains(field); },
                    handler: function (e, field) { t.datagrid("freezeColumn", field); }
                },
                {
                    text: "取消冻结该列", disabled: function (e, field) { return t.datagrid("getColumnFields", false).contains(field); },
                    handler: function (e, field) { t.datagrid("unfreezeColumn", field); }
                }
            ],
            enableHeaderClickMenu: true,
            enableHeaderContextMenu: true,
            enableRowContextMenu: false
        });

    });
    

</script>

<script>
       
        $("#btn").click(function(){
             // persontype = $('#persontype').val();
             // persontype = "A001";
             persontype =  localStorage.getItem("persontype")
             b0100 = localStorage.getItem("searchb001");
            sqlsearch = $('#sqlsearch').val();
             // b0100 = $('#b0100').val();
            //url = "{:U('Search/datedetail')}" + '/b0100/' + b0100 +'/persontype/' + persontype + '/sqlsearch/' + sqlsearch;
            // $('#myIframe').attr('src', url);

             var name = $('#name').val();
            $('#wu-datagrid').datagrid('load', { 
                b0100:  b0100,
                sqlsearch:sqlsearch,
                persontype:persontype
            }); 
        });


        function searchname(){
            var name = $('#name').val();
            $('#wu-datagrid').datagrid('load', { 
                b0100: '{$b0100}',   
                name: name  
            }); 
        }
</script>


<!-- 个人信息弹窗 -->
<script type="text/javascript">
    function openShow(value){
        showMessageDialog('{:U("User/epersoninfo")}'+'/a0100/'+value,'详细信息',900,500,true);
    }
    function fenxi(value) {
        // body...
        showBigMessageDialog('{:U("Date/epersoninfo")}'+'/a0100/'+value,'详细信息',900,500,true);
    }
    //url：窗口调用地址，title：窗口标题，width：宽度，height：高度，shadow：是否显示背景阴影罩层
    function showMessageDialog(url, title, width, height, shadow) {
        var content = '<iframe src="' + url + '" width="100%" height="99%" frameborder="0" scrolling="no"></iframe>';
        var boarddiv = '<div id="msgwindow" title="' + title + '"></div>'
        //style="overflow:hidden;"可以去掉滚动条
        $(document.body).append(boarddiv);
        var win = $('#msgwindow').dialog({
            content: content,
            width: width,
            height: height,
            modal: shadow,
            title: title,
            closable:true,    
            collapsible:true,
            // minimizable:true,
            // maximizable:true,
            onClose: function () {
                $(this).dialog('destroy');//后面可以关闭后的事件
            }
        });
        win.dialog('open');
    }
    function showBigMessageDialog(url, title, width, height, shadow) {
        var content = '<iframe src="' + url + '" width="100%" height="99%" frameborder="0" scrolling="no"></iframe>';
        var boarddiv = '<div id="msgwindow" title="' + title + '"></div>'
        //style="overflow:hidden;"可以去掉滚动条
        $(document.body).append(boarddiv);
        var win = $('#msgwindow').dialog({
            content: content,
            width: width,
            height: height,
            modal: shadow,
            title: title,
            closable:true,    
            collapsible:true,
            minimizable:true,
            maximizable:true,
            onClose: function () {
                $(this).dialog('destroy');//后面可以关闭后的事件
            }
        });
        win.dialog('open');
    }
    
</script>


</body>


</html>